<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ê°„ë‹¨í•œ GIF ë³€í™˜ê¸°</title>
  <style>
    /* ìŠ¤íƒ€ì¼ ìƒëµ (ì´ì „ ê·¸ëŒ€ë¡œ ìœ ì§€ë¨) */
    /* í•„ìš”í•˜ë©´ ì—¬ê¸°ì— ë‹¤ì‹œ í¬í•¨ì‹œì¼œ ë“œë¦´ê²Œìš” */
  </style>
</head>
<body>
  <div id="gif-converter-container">
    <h1>ê°„ë‹¨í•œ GIF ë³€í™˜ê¸°</h1>
    <h2>Convert your videos to GIF</h2>
    <div id="drop-zone">
      <img class="main-icon" src="https://i.postimg.cc/Qd05H1nJ/image-icon.png" alt="Video to GIF Icon"/>
      <label id="file-label" for="file-input">
        ë™ì˜ìƒ íŒŒì¼ ì„ íƒ<br>Select Video files
        <small>ë˜ëŠ” ì—¬ê¸°ì— ë™ì˜ìƒ ë“œë¡­ / or drop videos here</small>
      </label>
      <input type="file" id="file-input" accept="video/*" />
    </div>

    <video id="video-preview" controls style="display:none;"></video>
    <img id="gif-preview" alt="Converted GIF" style="display:none;"/>

    <div class="controls">
      <div class="control-group">
        <label for="start-time">ì‹œì‘ ì‹œê°„ (ì´ˆ)</label>
        <input type="number" id="start-time" value="0" min="0" step="0.1" disabled/>
      </div>
      <div class="control-group">
        <label for="end-time">ì¢…ë£Œ ì‹œê°„ (ì´ˆ)</label>
        <input type="number" id="end-time" value="0" min="0" step="0.1" disabled/>
      </div>
      <div class="control-group">
        <label for="fps">ì´ˆë‹¹ í”„ë ˆì„ ìˆ˜ (FPS)</label>
        <select id="fps" disabled>
          <option value="10">10 FPS (ë‚®ìŒ)</option>
          <option value="15">15 FPS (ë³´í†µ)</option>
          <option value="20" selected>20 FPS (ì¢‹ìŒ)</option>
          <option value="25">25 FPS (ë†’ìŒ)</option>
        </select>
      </div>
    </div>

    <div class="buttons-group">
      <button id="convert-btn" disabled>ë³€í™˜ ì‹œì‘</button>
      <button id="download-btn" disabled>ë‹¤ìš´ë¡œë“œ</button>
    </div>

    <div id="output"></div>

    <div class="program-description">
      <ul>
        <li>âœ“ ë‹¤ì–‘í•œ ë™ì˜ìƒ íŒŒì¼ì„ GIFë¡œ ë³€í™˜í•©ë‹ˆë‹¤.</li>
        <li>âœ“ ì‹œì‘/ì¢…ë£Œ ì‹œê°„ ì„¤ì • ë° FPS ì¡°ì ˆ ê°€ëŠ¥</li>
        <li>âœ“ ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì‹¤í–‰ë˜ì–´ íŒŒì¼ ì „ì†¡ ì—†ìŒ</li>
        <li>âœ“ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë° í´ë¦­ ì§€ì›</li>
      </ul>
    </div>
  </div>

  <!-- FFmpeg ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
  <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.4/dist/ffmpeg.min.js"></script>

  <script>
    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({ log: true });

    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const fileLabel = document.getElementById('file-label');
    const videoPreview = document.getElementById('video-preview');
    const gifPreview = document.getElementById('gif-preview');
    const startTimeInput = document.getElementById('start-time');
    const endTimeInput = document.getElementById('end-time');
    const fpsSelect = document.getElementById('fps');
    const convertBtn = document.getElementById('convert-btn');
    const downloadBtn = document.getElementById('download-btn');
    const output = document.getElementById('output');

    let videoFile = null;

    // ğŸ›¡ï¸ body ì „ì²´ì—ì„œ ê¸°ë³¸ drag ì´ë²¤íŠ¸ ë§‰ê¸°
    ['dragover', 'drop'].forEach(event => {
      document.body.addEventListener(event, (e) => {
        e.preventDefault();
        e.stopPropagation();
      });
    });

    // âœ… ë“œë¡­ì¡´ ë™ì‘ ì •ì˜
    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      e.stopPropagation();
      dropZone.classList.add('dragover');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('dragover');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      e.stopPropagation();
      dropZone.classList.remove('dragover');
      if (e.dataTransfer.files.length > 0) {
        handleFile(e.dataTransfer.files[0]);
      }
    });

    fileInput.addEventListener('change', (e) => {
      handleFile(e.target.files[0]);
    });

    function handleFile(file) {
      if (!file || !file.type.startsWith('video/')) {
        output.textContent = 'ë™ì˜ìƒ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
        return;
      }

      videoFile = file;
      const videoUrl = URL.createObjectURL(videoFile);
      videoPreview.src = videoUrl;
      videoPreview.style.display = 'block';
      gifPreview.style.display = 'none';
      dropZone.style.display = 'none';
      fileLabel.innerHTML = `âœ… ${file.name}<br>íŒŒì¼ ì„ íƒë¨`;

      videoPreview.onloadedmetadata = () => {
        endTimeInput.value = videoPreview.duration.toFixed(1);
        startTimeInput.disabled = false;
        endTimeInput.disabled = false;
        fpsSelect.disabled = false;
        convertBtn.disabled = false;
        downloadBtn.disabled = true;
        output.textContent = 'ì„¤ì •ì„ ì¡°ì ˆí•œ í›„ ë³€í™˜ì„ ì‹œì‘í•˜ì„¸ìš”.';
      };

      videoPreview.onerror = () => {
        output.textContent = 'ë™ì˜ìƒ ë¯¸ë¦¬ë³´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
      };
    }

    convertBtn.addEventListener('click', async () => {
      if (!videoFile) {
        output.textContent = 'íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.';
        return;
      }

      const startTime = parseFloat(startTimeInput.value);
      const endTime = parseFloat(endTimeInput.value);
      const duration = endTime - startTime;
      const fps = parseInt(fpsSelect.value);

      if (startTime >= endTime || duration <= 0) {
        output.textContent = 'ì‹œì‘ ì‹œê°„ì´ ì¢…ë£Œ ì‹œê°„ë³´ë‹¤ ë¹ ë¥´ê±°ë‚˜ ê°™ìŠµë‹ˆë‹¤.';
        return;
      }

      convertBtn.disabled = true;
      output.textContent = 'ë³€í™˜ ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.';

      try {
        if (!ffmpeg.isLoaded()) {
          await ffmpeg.load();
        }

        await ffmpeg.FS('writeFile', videoFile.name, await fetchFile(videoFile));

        await ffmpeg.run(
          '-ss', startTime.toString(),
          '-to', endTime.toString(),
          '-i', videoFile.name,
          '-vf', `fps=${fps},scale=320:-1:flags=lanczos`,
          'output.gif'
        );

        const data = await ffmpeg.FS('readFile', 'output.gif');
        const gifBlob = new Blob([data.buffer], { type: 'image/gif' });
        const gifUrl = URL.createObjectURL(gifBlob);

        gifPreview.src = gifUrl;
        gifPreview.style.display = 'block';
        videoPreview.style.display = 'none';
        downloadBtn.disabled = false;
        output.textContent = 'ë³€í™˜ ì™„ë£Œ! ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì €ì¥í•˜ì„¸ìš”.';
      } catch (err) {
        console.error(err);
        output.textContent = 'ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
      } finally {
        convertBtn.disabled = false;
      }
    });

    downloadBtn.addEventListener('click', () => {
      if (!gifPreview.src) return;
      const link = document.createElement('a');
      link.href = gifPreview.src;
      link.download = 'converted.gif';
      link.click();
    });
  </script>
</body>
</html>
