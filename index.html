<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>간단한 GIF 변환기</title>
    <style>
        /* 'Paperlogy-8ExtraBold' 웹폰트 정의 */
        @font-face {
            font-family: 'Paperlogy-8ExtraBold';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/2408-3@1.0/Paperlogy-8ExtraBold.woff2') format('woff2');
            font-weight: 800;
            font-style: normal;
        }

        /* 전체 컨테이너의 기본 스타일 */
        #gif-converter-container {
            font-family: 'Paperlogy-8ExtraBold', 'Segoe UI', sans-serif;
            background-color: #f4f4f8;
            text-align: center;
            padding: 40px 20px;
            color: #333;
            max-width: 600px;
            margin: 0 auto;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            box-sizing: border-box;
        }

        /* 컨테이너 내부 요소 스타일링 */
        #gif-converter-container h1 {
            font-size: 28px;
            margin-bottom: 10px;
            color: #222;
        }

        #gif-converter-container h2 {
            font-size: 16px;
            font-weight: normal;
            color: #777;
            margin-bottom: 30px;
        }

        #gif-converter-container #drop-zone {
            border: 3px dashed #ccc;
            border-radius: 15px;
            padding: 40px 20px 30px;
            background-color: #fff;
            max-width: 500px;
            margin: 0 auto 30px;
            position: relative;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        #gif-converter-container #drop-zone.dragover {
            border-color: #f44336;
            background-color: #fff7f7;
        }
        
        #gif-converter-container .main-icon {
            width: 80px;
            height: auto;
            margin-bottom: 20px;
            vertical-align: middle;
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.1));
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        #gif-converter-container #file-input {
            display: none;
        }

        #gif-converter-container #file-label {
            background-color: #d32f2f;
            color: white;
            padding: 16px 30px;
            border-radius: 10px;
            cursor: pointer;
            display: inline-block;
            font-size: 16px;
            transition: background-color 0.3s ease;
            margin-bottom: 10px;
        }

        #gif-converter-container #file-label:hover {
            background-color: #b71c1c;
        }

        #gif-converter-container #file-label small {
            font-size: 12px;
            display: block;
            margin-top: 5px;
            line-height: 1.2;
        }

        #gif-converter-container #video-preview {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: none;
            margin: 0 auto 20px;
        }
        
        #gif-converter-container #gif-preview {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin: 20px auto;
            display: none;
        }

        #gif-converter-container .controls {
            margin-top: 20px;
            text-align: left;
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 400px;
            margin: 20px auto;
        }
        
        #gif-converter-container .control-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        #gif-converter-container .control-group label {
            flex-grow: 1;
            font-size: 16px;
            color: #555;
            text-align: left;
        }

        #gif-converter-container .control-group input,
        #gif-converter-container .control-group select {
            width: 150px;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-family: inherit;
        }

        #gif-converter-container .buttons-group {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 10px;
        }

        #gif-converter-container .buttons-group button {
            font-family: 'Paperlogy-8ExtraBold', sans-serif;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
            flex-grow: 1;
            max-width: 200px;
        }

        #gif-converter-container .buttons-group button:disabled {
            background-color: #aaa;
            cursor: not-allowed;
        }
        
        #gif-converter-container #convert-btn {
            background-color: #f9a825;
        }
        #gif-converter-container #convert-btn:hover:enabled {
            background-color: #f57f17;
        }
        
        #gif-converter-container #download-btn {
            background-color: #28a745;
        }
        #gif-converter-container #download-btn:hover:enabled {
            background-color: #1e7e34;
        }

        #gif-converter-container #output {
            margin-top: 30px;
            font-size: 16px;
            color: #777;
        }
        
        #gif-converter-container .program-description {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            text-align: left;
            font-size: 15px;
            line-height: 1.6;
            color: #555;
        }

        #gif-converter-container .program-description ul {
            list-style: none !important;
            padding-left: 0;
            font-family: 'Paperlogy-8ExtraBold', 'Segoe UI', sans-serif;
        }

        #gif-converter-container .program-description ul li {
            margin-bottom: 10px;
            position: relative;
            padding-left: 0;
            font-family: 'Paperlogy-8ExtraBold', 'Segoe UI', sans-serif;
        }

        #gif-converter-container .program-description ul li .check-icon {
            color: #4CAF50;
            margin-right: 8px;
            font-size: 1.2em;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div id="gif-converter-container">
        <h1>간단한 GIF 변환기</h1>
        <h2 data-ke-size="size26">Convert your videos to GIF</h2>
        <div id="drop-zone">
            <img class="main-icon" src="https://i.postimg.cc/Qd05H1nJ/image-icon.png" alt="Video to GIF Icon" />
            <label id="file-label" for="file-input">
                동영상 파일 선택<br>Select Video files
                <small>또는 여기에 동영상 드롭 / or drop videos here</small>
            </label>
            <input type="file" id="file-input" accept="video/*">
        </div>

        <video id="video-preview" controls></video>
        <img id="gif-preview" alt="Converted GIF">

        <div class="controls">
            <div class="control-group">
                <label for="start-time">시작 시간 (초)</label>
                <input type="number" id="start-time" value="0" min="0" step="0.1" disabled>
            </div>
            <div class="control-group">
                <label for="end-time">종료 시간 (초)</label>
                <input type="number" id="end-time" value="0" min="0" step="0.1" disabled>
            </div>
            <div class="control-group">
                <label for="fps">초당 프레임 수 (FPS)</label>
                <select id="fps" disabled>
                    <option value="10">10 FPS (낮음)</option>
                    <option value="15">15 FPS (보통)</option>
                    <option value="20" selected>20 FPS (좋음)</option>
                    <option value="25">25 FPS (높음)</option>
                </select>
            </div>
        </div>

        <div class="buttons-group">
            <button id="convert-btn" disabled>변환 시작</button>
            <button id="download-btn" disabled>다운로드</button>
        </div>

        <div id="output"></div>
        
        <div class="program-description">
            <ul data-ke-list-type="disc">
                <li><span class="check-icon">✓</span> <strong>동영상 to GIF:</strong> MP4, WEBM 등 다양한 동영상 파일을 GIF로 변환합니다.</li>
                <li><span class="check-icon">✓</span> <strong>구간 및 품질 설정:</strong> 변환할 동영상의 특정 구간을 설정하고, GIF의 부드러움(FPS)을 조절할 수 있습니다.</li>
                <li><span class="check-icon">✓</span> <strong>빠르고 안전한 변환:</strong> 모든 작업이 브라우저에서 이루어져 서버로 파일이 전송되지 않습니다.</li>
                <li><span class="check-icon">✓</span> <strong>간편한 사용법:</strong> 클릭 또는 드래그 앤 드롭만으로 쉽게 GIF를 만들 수 있습니다.</li>
            </ul>
        </div>
    </div>

    <script src="ffmpeg-core.js"></script>
    <script>
        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({ log: true });
        
        document.addEventListener('dragover', (e) => e.preventDefault());
        document.addEventListener('drop', (e) => e.preventDefault());
        
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const fileLabel = document.getElementById('file-label');
        const videoPreview = document.getElementById('video-preview');
        const gifPreview = document.getElementById('gif-preview');
        const startTimeInput = document.getElementById('start-time');
        const endTimeInput = document.getElementById('end-time');
        const fpsSelect = document.getElementById('fps');
        const convertBtn = document.getElementById('convert-btn');
        const downloadBtn = document.getElementById('download-btn');
        const output = document.getElementById('output');

        let videoFile = null;
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault(); 
            dropZone.classList.remove('dragover');
            handleFile(e.dataTransfer.files[0]);
        });

        fileInput.addEventListener('change', (e) => {
            handleFile(e.target.files[0]);
        });
        
        function handleFile(file) {
            if (!file || !file.type.startsWith('video/')) {
                output.textContent = '동영상 파일만 업로드할 수 있습니다.';
                return;
            }

            videoFile = file;
            const videoUrl = URL.createObjectURL(videoFile);
            
            videoPreview.src = videoUrl;
            videoPreview.style.display = 'block';
            gifPreview.style.display = 'none';
            dropZone.style.display = 'none';
            fileLabel.innerHTML = `✅ ${file.name}<br>파일 선택됨`;

            videoPreview.onloadedmetadata = () => {
                endTimeInput.value = videoPreview.duration.toFixed(1);
                startTimeInput.disabled = false;
                endTimeInput.disabled = false;
                fpsSelect.disabled = false;
                convertBtn.disabled = false;
                downloadBtn.disabled = true;
                output.textContent = '아래 설정을 조절한 후 변환 시작 버튼을 누르세요.';
            };
            videoPreview.onerror = () => {
                output.textContent = '동영상 파일을 불러오는 데 실패했습니다.';
            };
        }
        
        convertBtn.addEventListener('click', async () => {
            if (!videoFile) {
                output.textContent = '변환할 동영상 파일을 먼저 선택해주세요.';
                return;
            }

            output.textContent = '변환을 시작합니다. 잠시만 기다려주세요... (페이지가 잠시 멈출 수 있습니다)';
            convertBtn.disabled = true;
            downloadBtn.disabled = true;
            
            const startTime = parseFloat(startTimeInput.value);
            const endTime = parseFloat(endTimeInput.value);
            const duration = endTime - startTime;
            const fps = parseInt(fpsSelect.value);

            if (startTime >= endTime || duration <= 0) {
                output.textContent = '시작 시간이 종료 시간보다 크거나 같을 수 없습니다.';
                convertBtn.disabled = false;
                return;
            }

            try {
                // '변환 시작' 버튼을 눌렀을 때 엔진 로딩 시작
                if (!ffmpeg.isLoaded()) {
                    output.textContent = '변환 엔진을 로딩 중입니다...';
                    await ffmpeg.load();
                }
                
                await ffmpeg.FS('writeFile', videoFile.name, await fetchFile(videoFile));
                
                output.textContent = 'GIF로 변환 중...';
                await ffmpeg.run(
                    '-ss', startTime.toString(),
                    '-to', endTime.toString(),
                    '-i', videoFile.name, 
                    '-vf', `fps=${fps},scale=320:-1:flags=lanczos`,
                    'output.gif'
                );

                const data = await ffmpeg.FS('readFile', 'output.gif');
                const gifBlob = new Blob([data.buffer], { type: 'image/gif' });
                const gifUrl = URL.createObjectURL(gifBlob);

                gifPreview.src = gifUrl;
                gifPreview.style.display = 'block';
                videoPreview.style.display = 'none';
                downloadBtn.disabled = false;
                convertBtn.disabled = false;
                output.textContent = '변환이 완료되었습니다! 다운로드 버튼을 눌러 저장하세요.';
            } catch (error) {
                console.error(error);
                output.textContent = `변환 중 오류가 발생했습니다: ${error.message}`;
                convertBtn.disabled = false;
            }
        });

        downloadBtn.addEventListener('click', () => {
            if (!gifPreview.src) return;

            const link = document.createElement('a');
            link.href = gifPreview.src;
            link.download = `converted.gif`;
            link.click();
        });
    </script>
</body>
</html>